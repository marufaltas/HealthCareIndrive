{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import MapDistance from\"./MapDistance\";import\"./TrackOrder.css\";// دالة لحساب الوقت المقدر للوصول (بناءً على المسافة)\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function estimateArrivalTime(lat1,lng1,lat2,lng2){// حساب المسافة بين نقطتين (Haversine)\nfunction toRad(x){return x*Math.PI/180;}const R=6371;// km\nconst dLat=toRad(lat2-lat1);const dLon=toRad(lng2-lng1);const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));const distance=R*c;// سرعة افتراضية 40 كم/س\nconst speed=40;const time=distance/speed*60;// بالدقائق\nreturn Math.round(time);}export default function TrackOrder(_ref){let{user}=_ref;const[orders,setOrders]=useState([]);const[selected,setSelected]=useState(null);useEffect(()=>{if(!user)return;fetch(`http://localhost:5000/orders?patientId=${user.id}`).then(res=>res.json()).then(setOrders);},[user]);if(!user)return null;if(selected){var _order$serviceNames;const order=selected;return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:700,margin:\"24px auto\",background:'#fff',borderRadius:16,boxShadow:'0 2px 16px #3182ce22',padding:24},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#3182ce'},children:\"\\u062A\\u0641\\u0627\\u0635\\u064A\\u0644 \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"\\u0627\\u0644\\u062E\\u062F\\u0645\\u0627\\u062A \\u0627\\u0644\\u0645\\u0637\\u0644\\u0648\\u0628\\u0629:\"}),\" \",(_order$serviceNames=order.serviceNames)===null||_order$serviceNames===void 0?void 0:_order$serviceNames.join(\", \")]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"\\u0627\\u0644\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0623\\u0633\\u0627\\u0633\\u064A:\"}),\" \",order.basePrice,\" \\u062C.\\u0645\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"\\u0627\\u0644\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0645\\u0642\\u062A\\u0631\\u062D:\"}),\" \",order.suggestedPrice||'-',\" \\u062C.\\u0645\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"\\u0645\\u0642\\u062F\\u0645 \\u0627\\u0644\\u0631\\u0639\\u0627\\u064A\\u0629:\"}),\" \",order.providerName||'-',\" (\",order.providerPhone||'-',\")\"]}),/*#__PURE__*/_jsx(MapDistance,{patient:order.location,provider:order.providerLocation||{},orderId:order.id,liveTrack:true}),/*#__PURE__*/_jsx(\"button\",{style:{marginTop:16},onClick:()=>setSelected(null),children:\"\\u0631\\u062C\\u0648\\u0639\"})]});}return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:700,margin:\"24px auto\"},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'#3182ce'},children:\"\\u0637\\u0644\\u0628\\u0627\\u062A\\u0643 \\u0627\\u0644\\u062D\\u0627\\u0644\\u064A\\u0629\"}),orders.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#888',fontSize:18,padding:24},children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0637\\u0644\\u0628\\u0627\\u062A \\u0645\\u0633\\u062C\\u0644\\u0629 \\u0644\\u0647\\u0630\\u0627 \\u0627\\u0644\\u062D\\u0633\\u0627\\u0628 \\u062D\\u062A\\u0649 \\u0627\\u0644\\u0622\\u0646.\"}),orders.length>0&&/*#__PURE__*/_jsx(_Fragment,{children:orders.map(order=>{var _order$serviceNames2;return/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fff',borderRadius:12,boxShadow:'0 2px 8px #3182ce22',padding:16,marginBottom:16,display:'flex',justifyContent:'space-between',alignItems:'center',cursor:'pointer',border:order.status===\"accepted\"?\"2px solid #38b2ac\":order.status===\"rejected\"?\"2px solid #e53e3e\":\"2px solid #e2e8f0\"},onClick:()=>setSelected(order),children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:((_order$serviceNames2=order.serviceNames)===null||_order$serviceNames2===void 0?void 0:_order$serviceNames2.join(\", \"))||order.serviceName||\"-\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:13,color:'#666'},children:[\"\\u0627\\u0644\\u0633\\u0639\\u0631: \",order.basePrice,\" \\u062C.\\u0645\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:13,color:'#666'},children:[\"\\u0645\\u0642\\u062F\\u0645 \\u0627\\u0644\\u0631\\u0639\\u0627\\u064A\\u0629: \",order.providerName||'-']}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:13,color:'#888'},children:[\"\\u0627\\u0644\\u062D\\u0627\\u0644\\u0629: \",order.status===\"new\"?\"جديد\":order.status===\"accepted\"?\"مقبول\":order.status===\"rejected\"?\"مرفوض\":order.status===\"done\"?\"تم الإنجاز\":order.status]})]}),/*#__PURE__*/_jsx(\"span\",{style:{color:'#3182ce',fontWeight:700},children:\"\\u062A\\u0641\\u0627\\u0635\\u064A\\u0644 \\u2192\"})]},order.id);})})]});}","map":{"version":3,"names":["React","useEffect","useState","MapDistance","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","estimateArrivalTime","lat1","lng1","lat2","lng2","toRad","x","Math","PI","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","distance","speed","time","round","TrackOrder","_ref","user","orders","setOrders","selected","setSelected","fetch","id","then","res","json","_order$serviceNames","order","style","maxWidth","margin","background","borderRadius","boxShadow","padding","children","color","serviceNames","join","basePrice","suggestedPrice","providerName","providerPhone","patient","location","provider","providerLocation","orderId","liveTrack","marginTop","onClick","length","fontSize","map","_order$serviceNames2","marginBottom","display","justifyContent","alignItems","cursor","border","status","serviceName","fontWeight"],"sources":["C:/Users/Pc/Desktop/DnsJumper/backend/nurse-tracking-Patient/src/components/TrackOrder.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport MapDistance from \"./MapDistance\";\r\nimport \"./TrackOrder.css\";\r\n\r\n// دالة لحساب الوقت المقدر للوصول (بناءً على المسافة)\r\nfunction estimateArrivalTime(lat1, lng1, lat2, lng2) {\r\n  // حساب المسافة بين نقطتين (Haversine)\r\n  function toRad(x) { return x * Math.PI / 180; }\r\n  const R = 6371; // km\r\n  const dLat = toRad(lat2 - lat1);\r\n  const dLon = toRad(lng2 - lng1);\r\n  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *\r\n    Math.sin(dLon/2) * Math.sin(dLon/2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  const distance = R * c;\r\n  // سرعة افتراضية 40 كم/س\r\n  const speed = 40;\r\n  const time = distance / speed * 60; // بالدقائق\r\n  return Math.round(time);\r\n}\r\n\r\nexport default function TrackOrder({ user }) {\r\n  const [orders, setOrders] = useState([]);\r\n  const [selected, setSelected] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    fetch(`http://localhost:5000/orders?patientId=${user.id}`)\r\n      .then(res => res.json())\r\n      .then(setOrders);\r\n  }, [user]);\r\n\r\n  if (!user) return null;\r\n\r\n  if (selected) {\r\n    const order = selected;\r\n    return (\r\n      <div style={{maxWidth:700,margin:\"24px auto\",background:'#fff',borderRadius:16,boxShadow:'0 2px 16px #3182ce22',padding:24}}>\r\n        <h2 style={{color:'#3182ce'}}>تفاصيل الطلب</h2>\r\n        <div><b>الخدمات المطلوبة:</b> {order.serviceNames?.join(\", \")}</div>\r\n        <div><b>السعر الأساسي:</b> {order.basePrice} ج.م</div>\r\n        <div><b>السعر المقترح:</b> {order.suggestedPrice || '-'} ج.م</div>\r\n        <div><b>مقدم الرعاية:</b> {order.providerName || '-'} ({order.providerPhone || '-'})</div>\r\n        <MapDistance patient={order.location} provider={order.providerLocation || {}} orderId={order.id} liveTrack={true} />\r\n        <button style={{marginTop:16}} onClick={()=>setSelected(null)}>رجوع</button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{maxWidth:700,margin:\"24px auto\"}}>\r\n      <h2 style={{color:'#3182ce'}}>طلباتك الحالية</h2>\r\n      {orders.length === 0 && <div style={{color:'#888',fontSize:18,padding:24}}>لا توجد طلبات مسجلة لهذا الحساب حتى الآن.</div>}\r\n      {orders.length > 0 && (\r\n        <>\r\n          {orders.map(order => (\r\n            <div key={order.id} style={{background:'#fff',borderRadius:12,boxShadow:'0 2px 8px #3182ce22',padding:16,marginBottom:16,display:'flex',justifyContent:'space-between',alignItems:'center',cursor:'pointer',border: order.status===\"accepted\"?\"2px solid #38b2ac\":order.status===\"rejected\"?\"2px solid #e53e3e\":\"2px solid #e2e8f0\"}} onClick={()=>setSelected(order)}>\r\n              <div>\r\n                <b>{order.serviceNames?.join(\", \") || order.serviceName || \"-\"}</b>\r\n                <div style={{fontSize:13,color:'#666'}}>السعر: {order.basePrice} ج.م</div>\r\n                <div style={{fontSize:13,color:'#666'}}>مقدم الرعاية: {order.providerName || '-'}</div>\r\n                <div style={{fontSize:13,color:'#888'}}>الحالة: {order.status === \"new\" ? \"جديد\" : order.status === \"accepted\" ? \"مقبول\" : order.status === \"rejected\" ? \"مرفوض\" : order.status === \"done\" ? \"تم الإنجاز\" : order.status}</div>\r\n              </div>\r\n              <span style={{color:'#3182ce',fontWeight:700}}>تفاصيل &rarr;</span>\r\n            </div>\r\n          ))}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}