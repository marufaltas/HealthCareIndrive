{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{MapContainer,TileLayer,Marker,Polyline,Popup}from\"react-leaflet\";import L from\"leaflet\";import\"leaflet/dist/leaflet.css\";// أيقونة مخصصة للطرفين\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const patientIcon=new L.Icon({iconUrl:\"/user-placeholder.png\",iconSize:[38,38],iconAnchor:[19,38]});const providerIcon=new L.Icon({iconUrl:\"/nurse-icon.png\",iconSize:[38,38],iconAnchor:[19,38]});// دالة حساب المسافة بين نقطتين بالإحداثيات (كيلومتر)\nfunction haversine(lat1,lon1,lat2,lon2){function toRad(x){return x*Math.PI/180;}const R=6371;const dLat=toRad(lat2-lat1);const dLon=toRad(lon2-lon1);const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;}export default function MapDistance(_ref){let{patient,provider,orderId,liveTrack}=_ref;// liveTrack=true: تفعيل التتبع الحي للطرفين\nconst[patientPos,setPatientPos]=useState([parseFloat(patient===null||patient===void 0?void 0:patient.lat),parseFloat(patient===null||patient===void 0?void 0:patient.lng)]);const[providerPos,setProviderPos]=useState([parseFloat(provider===null||provider===void 0?void 0:provider.lat),parseFloat(provider===null||provider===void 0?void 0:provider.lng)]);// تحديث المواقع تلقائياً كل 10 ثواني إذا كان liveTrack مفعل\nuseEffect(()=>{if(!liveTrack||!orderId)return;const interval=setInterval(()=>{fetch(`http://localhost:5000/orders/${orderId}`).then(res=>res.json()).then(order=>{var _order$location,_order$location2,_order$providerLocati,_order$providerLocati2;if((_order$location=order.location)!==null&&_order$location!==void 0&&_order$location.lat&&(_order$location2=order.location)!==null&&_order$location2!==void 0&&_order$location2.lng)setPatientPos([parseFloat(order.location.lat),parseFloat(order.location.lng)]);if((_order$providerLocati=order.providerLocation)!==null&&_order$providerLocati!==void 0&&_order$providerLocati.lat&&(_order$providerLocati2=order.providerLocation)!==null&&_order$providerLocati2!==void 0&&_order$providerLocati2.lng)setProviderPos([parseFloat(order.providerLocation.lat),parseFloat(order.providerLocation.lng)]);});},10000);return()=>clearInterval(interval);},[liveTrack,orderId]);if(!patientPos[0]||!patientPos[1]||!providerPos[0]||!providerPos[1])return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0628\\u064A\\u0627\\u0646\\u0627\\u062A \\u0625\\u062D\\u062F\\u0627\\u062B\\u064A\\u0627\\u062A \\u0643\\u0627\\u0641\\u064A\\u0629\"});const distance=haversine(patientPos[0],patientPos[1],providerPos[0],providerPos[1]);const estTime=Math.round(distance/0.5+10);// 0.5 كم/دقيقة = 30 كم/س\nconst cost=Math.round(distance*5);return/*#__PURE__*/_jsxs(\"div\",{style:{width:'100%',height:350,margin:'16px 0',borderRadius:12,overflow:'hidden',boxShadow:'0 2px 12px #3182ce22'},children:[/*#__PURE__*/_jsxs(MapContainer,{center:patientPos,zoom:13,style:{height:350,width:'100%'},scrollWheelZoom:true,children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),/*#__PURE__*/_jsx(Marker,{position:patientPos,icon:patientIcon,children:/*#__PURE__*/_jsx(Popup,{children:\"\\u0645\\u0648\\u0642\\u0639 \\u0627\\u0644\\u0645\\u0631\\u064A\\u0636\"})}),/*#__PURE__*/_jsx(Marker,{position:providerPos,icon:providerIcon,children:/*#__PURE__*/_jsx(Popup,{children:\"\\u0645\\u0648\\u0642\\u0639 \\u0645\\u0642\\u062F\\u0645 \\u0627\\u0644\\u0631\\u0639\\u0627\\u064A\\u0629\"})}),/*#__PURE__*/_jsx(Polyline,{positions:[providerPos,patientPos],color:\"#3182ce\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:8,background:'#fff',borderRadius:'0 0 12px 12px',boxShadow:'0 2px 8px #0001',display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0627\\u0644\\u0645\\u0633\\u0627\\u0641\\u0629: \",/*#__PURE__*/_jsxs(\"b\",{children:[distance.toFixed(2),\" \\u0643\\u0645\"]})]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0627\\u0644\\u0648\\u0642\\u062A \\u0627\\u0644\\u0645\\u062A\\u0648\\u0642\\u0639: \",/*#__PURE__*/_jsxs(\"b\",{children:[estTime,\" \\u062F\\u0642\\u064A\\u0642\\u0629\"]})]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u062A\\u0643\\u0644\\u0641\\u0629 \\u0627\\u0644\\u0648\\u0635\\u0648\\u0644: \",/*#__PURE__*/_jsxs(\"b\",{children:[cost,\" \\u062C.\\u0645\"]})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","MapContainer","TileLayer","Marker","Polyline","Popup","L","jsx","_jsx","jsxs","_jsxs","patientIcon","Icon","iconUrl","iconSize","iconAnchor","providerIcon","haversine","lat1","lon1","lat2","lon2","toRad","x","Math","PI","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","MapDistance","_ref","patient","provider","orderId","liveTrack","patientPos","setPatientPos","parseFloat","lat","lng","providerPos","setProviderPos","interval","setInterval","fetch","then","res","json","order","_order$location","_order$location2","_order$providerLocati","_order$providerLocati2","location","providerLocation","clearInterval","children","distance","estTime","round","cost","style","width","height","margin","borderRadius","overflow","boxShadow","center","zoom","scrollWheelZoom","url","position","icon","positions","color","padding","background","display","justifyContent","alignItems","toFixed"],"sources":["C:/Users/Pc/Desktop/DnsJumper/backend/nurse-tracking-Patient/src/components/MapDistance.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { MapContainer, TileLayer, Marker, Polyline, Popup } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\n\r\n// أيقونة مخصصة للطرفين\r\nconst patientIcon = new L.Icon({\r\n  iconUrl: \"/user-placeholder.png\",\r\n  iconSize: [38, 38],\r\n  iconAnchor: [19, 38],\r\n});\r\nconst providerIcon = new L.Icon({\r\n  iconUrl: \"/nurse-icon.png\",\r\n  iconSize: [38, 38],\r\n  iconAnchor: [19, 38],\r\n});\r\n\r\n// دالة حساب المسافة بين نقطتين بالإحداثيات (كيلومتر)\r\nfunction haversine(lat1, lon1, lat2, lon2) {\r\n  function toRad(x) { return x * Math.PI / 180; }\r\n  const R = 6371;\r\n  const dLat = toRad(lat2 - lat1);\r\n  const dLon = toRad(lon2 - lon1);\r\n  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *\r\n    Math.sin(dLon/2) * Math.sin(dLon/2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  return R * c;\r\n}\r\n\r\nexport default function MapDistance({ patient, provider, orderId, liveTrack }) {\r\n  // liveTrack=true: تفعيل التتبع الحي للطرفين\r\n  const [patientPos, setPatientPos] = useState([parseFloat(patient?.lat), parseFloat(patient?.lng)]);\r\n  const [providerPos, setProviderPos] = useState([parseFloat(provider?.lat), parseFloat(provider?.lng)]);\r\n\r\n  // تحديث المواقع تلقائياً كل 10 ثواني إذا كان liveTrack مفعل\r\n  useEffect(() => {\r\n    if (!liveTrack || !orderId) return;\r\n    const interval = setInterval(() => {\r\n      fetch(`http://localhost:5000/orders/${orderId}`)\r\n        .then(res => res.json())\r\n        .then(order => {\r\n          if (order.location?.lat && order.location?.lng) setPatientPos([parseFloat(order.location.lat), parseFloat(order.location.lng)]);\r\n          if (order.providerLocation?.lat && order.providerLocation?.lng) setProviderPos([parseFloat(order.providerLocation.lat), parseFloat(order.providerLocation.lng)]);\r\n        });\r\n    }, 10000);\r\n    return () => clearInterval(interval);\r\n  }, [liveTrack, orderId]);\r\n\r\n  if (!patientPos[0] || !patientPos[1] || !providerPos[0] || !providerPos[1]) return <div>لا توجد بيانات إحداثيات كافية</div>;\r\n  const distance = haversine(patientPos[0], patientPos[1], providerPos[0], providerPos[1]);\r\n  const estTime = Math.round((distance / 0.5) + 10); // 0.5 كم/دقيقة = 30 كم/س\r\n  const cost = Math.round(distance * 5);\r\n  return (\r\n    <div style={{width:'100%',height:350,margin:'16px 0',borderRadius:12,overflow:'hidden',boxShadow:'0 2px 12px #3182ce22'}}>\r\n      <MapContainer center={patientPos} zoom={13} style={{height:350,width:'100%'}} scrollWheelZoom={true}>\r\n        <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n        <Marker position={patientPos} icon={patientIcon}>\r\n          <Popup>موقع المريض</Popup>\r\n        </Marker>\r\n        <Marker position={providerPos} icon={providerIcon}>\r\n          <Popup>موقع مقدم الرعاية</Popup>\r\n        </Marker>\r\n        <Polyline positions={[providerPos, patientPos]} color=\"#3182ce\" />\r\n      </MapContainer>\r\n      <div style={{padding:8,background:'#fff',borderRadius:'0 0 12px 12px',boxShadow:'0 2px 8px #0001',display:'flex',justifyContent:'space-between',alignItems:'center'}}>\r\n        <span>المسافة: <b>{distance.toFixed(2)} كم</b></span>\r\n        <span>الوقت المتوقع: <b>{estTime} دقيقة</b></span>\r\n        <span>تكلفة الوصول: <b>{cost} ج.م</b></span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}